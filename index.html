<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>truedhrec</title>
  </head>
  <script>
  var commanders, baseURL = "https://edhrec-json.s3.amazonaws.com/en/commanders/"
  var allData = []
  var combos = [
    "w",

    "w",
    "u",
    "b",
    "r",
    "g",
    "colorless",

    "wu",
    "wb",
    "rw",
    "gw",
    "ub",
    "ur",
    "gu",
    "br",
    "bg",
    "rg",

    "wub", //esper
    "urw", //jeskai
    "gwu", //bant
    "rwb", //mardu
    "wbg", //abzan
    "rgw", //naya
    "ubr", //grixis
    "gur", //temur
    "bgu", //sultai
    "brg", //jund

    "brgw",
    "rgwu",
    "gwub",
    "wubr",
    "ubrg",

    "wubrg"

  ]

  var count = 0
  function init () {
    // fetch("https://edhrec-json.s3.amazonaws.com/en/commanders/u.json").then(res => res.json()).then(handleData)
    displayArea = document.getElementById('displayArea')
    recursiveFetch()
  }


  function recursiveFetch(data = false) { //COUNT MUST BE 0 BEFORE CALLING THIS
    if (data !== false) {
      allData.push( {"name": combos[count], "data": data} )
    }

    //

  fetch("https://cors-anywhere.herokuapp.com/" + baseURL +  combos[count] + '.json', {
  "headers": {
    "origin": window.location.href
  }
}).then(res => res.json()).then(updateData)

  }

  function handleRecursiveFetch() {
    recursiveFetch(tempData)
  }


  function updateData (data) {
    // console.log(data)
    tempData = data
    // console.log(tempData)
    count++
    if (count < combos.length) {
      setTimeout(handleRecursiveFetch, 50)
    } else {
      beginDisplay()
    }


  }

  function beginDisplay () {
    allData2 = makeReadable(allData)
    // console.log(allData, allData2)

    // allData2.sort

    allData2.sort(function(a,b) {
      return b.deck_count - a.deck_count
    })

    console.log(allData2)

    for (let i = 0; i < allData2.length; i++) {}
  }

  function makeReadable(d) {
    let output = []
    for (let i = 0; i < d.length; i++) {




      //
      // console.log(d[i].data.container.json_dict.cardlists[0].cardviews)
      for (let n = 0; n < d[i].data.container.json_dict.cardlists[0].cardviews.length; n++) {
        // console.log(d[i].data.container.json_dict.cardlists[0][n], d[i].data.container.json_dict.cardlists[0])
        d[i].data.container.json_dict.cardlists[0].cardviews[n].deck_count = parseInt(d[i].data.container.json_dict.cardlists[0].cardviews[n].label.split(" ")[0])
        output.push(d[i].data.container.json_dict.cardlists[0].cardviews[n])
      }

    }
    return output
  }

  function handleData(data) {
    // console.log(data)
    commanders = data
    displayData(commanders)
  }


  function displayData(data) {
    console.log(data.container.json_dict.cardlists)
  }

  document.addEventListener("DOMContentLoaded", init)

  </script>
  <body>
    <div id="displayArea"></div>
  </body>
</html>
